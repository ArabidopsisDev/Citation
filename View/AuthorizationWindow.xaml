<Window
	x:Class="Citation.View.AuthorizationWindow"
	xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
	xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
	xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
	xmlns:local="clr-namespace:Citation.View"
	xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
	xmlns:xctk="http://schemas.xceed.com/wpf/xaml/toolkit"
	Title="授权管理"
	Width="700"
	Height="648"
	Background="#F5F7F9"
	ResizeMode="NoResize"
	WindowStartupLocation="CenterScreen"
	mc:Ignorable="d">

	<Window.Resources>
		<Style TargetType="TextBox">
			<Setter Property="BorderThickness" Value="0,0,0,1" />
			<Setter Property="BorderBrush" Value="#D1D9E0" />
			<Setter Property="Padding" Value="0,8" />
			<Setter Property="FontSize" Value="15" />
			<Setter Property="FontFamily" Value="Segoe UI" />
			<Setter Property="Background" Value="Transparent" />
			<Setter Property="Foreground" Value="#2C3E50" />
			<Setter Property="CaretBrush" Value="#3498DB" />
		</Style>

		<Style x:Key="PrimaryButton" TargetType="Button">
			<Setter Property="Margin" Value="10,0" />
			<Setter Property="Padding" Value="24,10" />
			<Setter Property="FontSize" Value="14" />
			<Setter Property="FontWeight" Value="SemiBold" />
			<Setter Property="Foreground" Value="White" />
			<Setter Property="Background" Value="#3498DB" />
			<Setter Property="BorderThickness" Value="0" />
			<Setter Property="Cursor" Value="Hand" />
			<Setter Property="Template">
				<Setter.Value>
					<ControlTemplate TargetType="Button">
						<Border
							x:Name="border"
							Background="{TemplateBinding Background}"
							CornerRadius="4">
							<ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center" />
						</Border>
						<ControlTemplate.Triggers>
							<Trigger Property="IsMouseOver" Value="True">
								<Setter Property="Background" Value="#2980B9" />
							</Trigger>
							<Trigger Property="IsPressed" Value="True">
								<Setter Property="Background" Value="#21618C" />
							</Trigger>
						</ControlTemplate.Triggers>
					</ControlTemplate>
				</Setter.Value>
			</Setter>
		</Style>

		<Style
			x:Key="SecondaryButton"
			BasedOn="{StaticResource PrimaryButton}"
			TargetType="Button">
			<Setter Property="Background" Value="#95A5A6" />
			<Setter Property="Foreground" Value="White" />
			<Setter Property="Template">
				<Setter.Value>
					<ControlTemplate TargetType="Button">
						<Border
							x:Name="border"
							Background="{TemplateBinding Background}"
							CornerRadius="4">
							<ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center" />
						</Border>
						<ControlTemplate.Triggers>
							<Trigger Property="IsMouseOver" Value="True">
								<Setter Property="Background" Value="#7F8C8D" />
							</Trigger>
							<Trigger Property="IsPressed" Value="True">
								<Setter Property="Background" Value="#626567" />
							</Trigger>
						</ControlTemplate.Triggers>
					</ControlTemplate>
				</Setter.Value>
			</Setter>
		</Style>

		<Style x:Key="DeleteButton" TargetType="Button">
			<Setter Property="Background" Value="Transparent" />
			<Setter Property="BorderThickness" Value="0" />
			<Setter Property="Padding" Value="6" />
			<Setter Property="Cursor" Value="Hand" />
			<Setter Property="Template">
				<Setter.Value>
					<ControlTemplate TargetType="Button">
						<Border
							x:Name="border"
							Width="24"
							Height="24"
							Background="Transparent"
							CornerRadius="12">
							<TextBlock
								HorizontalAlignment="Center"
								VerticalAlignment="Center"
								FontSize="14"
								FontWeight="Bold"
								Foreground="#E74C3C"
								Text="✕" />
						</Border>
						<ControlTemplate.Triggers>
							<Trigger Property="IsMouseOver" Value="True">
								<Setter TargetName="border" Property="Background" Value="#FFEBEE" />
							</Trigger>
						</ControlTemplate.Triggers>
					</ControlTemplate>
				</Setter.Value>
			</Setter>
		</Style>

		<Style TargetType="TextBlock">
			<Setter Property="Foreground" Value="#34495E" />
			<Setter Property="FontFamily" Value="Segoe UI" />
		</Style>

		<Style x:Key="IpItemStyle" TargetType="ListBoxItem">
			<Setter Property="Template">
				<Setter.Value>
					<ControlTemplate TargetType="ListBoxItem">
						<Border
							x:Name="border"
							Padding="8,6"
							Background="Transparent">
							<ContentPresenter />
						</Border>
						<ControlTemplate.Triggers>
							<Trigger Property="IsMouseOver" Value="True">
								<Setter TargetName="border" Property="Background" Value="#F8F9FA" />
							</Trigger>
						</ControlTemplate.Triggers>
					</ControlTemplate>
				</Setter.Value>
			</Setter>
		</Style>
	</Window.Resources>

	<Grid Margin="20">
		<Grid.RowDefinitions>
			<RowDefinition Height="Auto" />
			<RowDefinition Height="Auto" />
			<RowDefinition Height="*" />
			<RowDefinition Height="Auto" />
		</Grid.RowDefinitions>

		<StackPanel
			Grid.Row="0"
			Margin="0,0,0,15"
			Orientation="Horizontal">
			<Image
				Width="28"
				Height="28"
				Margin="0,0,12,0"
				Source="pack://application:,,,/Citation;component/Images/warning.png" />
			<TextBlock
				VerticalAlignment="Center"
				FontFamily="SimHei"
				FontSize="20"
				Text="授权访问" />
			<TextBlock
				Margin="5,0,0,0"
				VerticalAlignment="Center"
				FontFamily="SimHei"
				FontSize="20"
				FontWeight="SemiBold"
				Foreground="#E74C3C"
				Text="（危险操作）" />
		</StackPanel>

		<Border
			Grid.Row="1"
			Margin="0,0,0,20"
			Padding="15,12"
			Background="#FEF5F5"
			BorderBrush="#FDEDED"
			BorderThickness="1"
			CornerRadius="4">
			<StackPanel Orientation="Horizontal">
				<TextBlock
					Margin="0,0,10,0"
					VerticalAlignment="Center"
					FontSize="16"
					Foreground="#E74C3C"
					Text="⚠️" />
				<TextBlock
					AllowDrop="True"
					FontFamily="Times New Roman,SimSun"
					FontSize="14"
					Foreground="#E74C3C"
					Text="您正在创建授权文件，这将允许他人访问您的科研项目文件。（某项留空代表不限制）&#x0A;Citation的授权功能只是一把君子锁，最重要的是保管好自己的项目文件不要泄露。"
					TextAlignment="Left"
					TextWrapping="Wrap" />
			</StackPanel>
		</Border>

		<Grid Grid.Row="2" Margin="0,0,0,25">
			<Grid.RowDefinitions>
				<RowDefinition Height="Auto" />
				<RowDefinition Height="Auto" />
				<RowDefinition Height="Auto" />
			</Grid.RowDefinitions>

			<StackPanel
				Grid.Row="0"
				Margin="0,0,0,25"
				Orientation="Vertical">
				<TextBlock
					Margin="0,0,0,8"
					FontSize="15"
					FontWeight="SemiBold"
					Text="项目密码（本项必填，用于验证您的身份）" />
				<TextBox Text="{Binding Authorization.Password, UpdateSourceTrigger=PropertyChanged}" />
			</StackPanel>

			<StackPanel
				Grid.Row="1"
				Margin="0,0,0,25"
				Orientation="Vertical">
				<TextBlock
					Margin="0,0,0,8"
					FontSize="15"
					FontWeight="SemiBold"
					Text="本机序列号列表" />

				<StackPanel Margin="0,0,0,10" Orientation="Horizontal">
					<TextBox
						x:Name="NewIpTextBox"
						Width="350"
						Foreground="#95A5A6"
						GotFocus="NewIpTextBox_GotFocus"
						LostFocus="NewIpTextBox_LostFocus"
						Text="输入本机序列号 (例如: 0A06A2-123733-5AC45C)" />
					<Button
						Width="90"
						Margin="30,0,0,0"
						Padding="15,8"
						Click="AddIp_Click"
						Content="添加"
						Style="{StaticResource PrimaryButton}" />
				</StackPanel>

				<Border
					Height="120"
					Padding="0,5"
					Background="White"
					BorderBrush="#E3E8EE"
					BorderThickness="1"
					CornerRadius="4">
					<ListBox
						BorderThickness="0"
						ItemContainerStyle="{StaticResource IpItemStyle}"
						ItemsSource="{Binding Authorization.IpAddresses}"
						ScrollViewer.HorizontalScrollBarVisibility="Disabled">
						<ListBox.ItemTemplate>
							<DataTemplate>
								<Grid Margin="0,2">
									<Grid.ColumnDefinitions>
										<ColumnDefinition Width="*" />
										<ColumnDefinition Width="Auto" />
									</Grid.ColumnDefinitions>

									<TextBlock
										Grid.Column="0"
										Margin="10,0,0,0"
										VerticalAlignment="Center"
										FontSize="14"
										Text="{Binding}" />

									<Button
										Grid.Column="1"
										Click="RemoveIp_Click"
										CommandParameter="{Binding}"
										Style="{StaticResource DeleteButton}" />
								</Grid>
							</DataTemplate>
						</ListBox.ItemTemplate>
					</ListBox>
				</Border>
			</StackPanel>

			<StackPanel Grid.Row="2" Orientation="Vertical">
				<TextBlock
					Margin="0,0,0,8"
					FontSize="15"
					FontWeight="SemiBold"
					Text="过期时间" />
				<xctk:DateTimePicker
					Background="Transparent"
					BorderBrush="#D1D9E0"
					BorderThickness="0,0,0,1"
					FontFamily="Segoe UI"
					FontSize="15"
					Format="Custom"
					FormatString="yyyy/M/dd HH:mm:ss"
					Watermark="选择过期时间"
					Value="{Binding Authorization.ExpirationTime}" />
			</StackPanel>
		</Grid>

		<StackPanel
			Grid.Row="3"
			HorizontalAlignment="Right"
			Orientation="Horizontal">
			<Button
				Width="90"
				Height="40"
				Click="Cancel_Click"
				Content="取消"
				Style="{StaticResource SecondaryButton}" />
			<Button
				Width="90"
				Height="40"
				Click="Confirm_Click"
				Content="确认授权"
				Style="{StaticResource PrimaryButton}" />
		</StackPanel>

		<Border
			x:Name="DisabledOverlay"
			Grid.RowSpan="4"
			Background="#CCCCCC"
			Visibility="Collapsed">
			<StackPanel HorizontalAlignment="Center" VerticalAlignment="Center">
				<Image Width="200" Source="pack://application:,,,/Citation;component/Images/lock.png" />
				<TextBlock
					Margin="0,50,0,0"
					HorizontalAlignment="Center"
					FontFamily="Calibri, SimHei"
					FontSize="35"
					FontWeight="Bold"
					Foreground="#666666"
					Text="Citation Security©  已禁用" />
				<TextBlock Margin="0,30,0,0" HorizontalAlignment="Center">
					<Hyperlink
						Click="Hyperlink_Click"
						FontFamily="Simsun"
						FontSize="15">
						在演示版和试用版中，该功能会被禁用，以保障正式版用户权益不受损害
					</Hyperlink>
				</TextBlock>
				<Label
					Margin="50,10,0,0"
					FontFamily="Times New Roman, Simsun"
					FontSize="15">
					Citation Security© By Arabidopsis 2025. All right reserved.
				</Label>
			</StackPanel>
		</Border>
	</Grid>
</Window>