<UserControl x:Class="Citation.View.Page.ViewReferencePage"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:c="clr-namespace:Citation.Model.Convert"
             xmlns:model="clr-namespace:Citation.Model.Reference"
             mc:Ignorable="d" Loaded="ViewReferencePage_OnLoaded"
             d:DesignHeight="600" d:DesignWidth="800">

	<UserControl.Resources>
		<c:AuthorConverter x:Key="AuthorsConverter"/>
		<c:DateConverter x:Key="DateConverter"/>

		<HierarchicalDataTemplate DataType="{x:Type model:FolderItem}" ItemsSource="{Binding Articles}">
			<StackPanel Orientation="Horizontal">
				<Image Source="pack://application:,,,/Citation;component/Images/folder.png" Width="16" Height="20"   Margin="0,0,5,0"/>
				<TextBlock Text="{Binding Name}" VerticalAlignment="Center" FontWeight="SemiBold"/>
				<TextBlock Text="{Binding Articles.Count, StringFormat=' ({0})'}" 
                           VerticalAlignment="Center" 
                           Foreground="Gray"
                           Margin="5,0,0,0"/>
			</StackPanel>
		</HierarchicalDataTemplate>

		<DataTemplate DataType="{x:Type model:JournalArticle}">
			<StackPanel Orientation="Horizontal" Margin="10,2,0,2">
				<Image Source="pack://application:,,,/Citation;component/Images/article.png" Width="16" Height="16" Margin="0,0,5,0"/>
				<TextBlock Text="{Binding Message.Title[0]}" VerticalAlignment="Center"/>
			</StackPanel>
		</DataTemplate>
	</UserControl.Resources>

	<Grid Background="#F5F5F5">
		<Grid.ColumnDefinitions>
			<ColumnDefinition Width="250"/>
			<ColumnDefinition Width="*"/>
		</Grid.ColumnDefinitions>

		<!-- 左侧文件夹树保持不变 -->
		<TreeView Grid.Column="0" 
                  Margin="10" 
				  Name="FolderTreeView" 
                  SelectedItemChanged="TreeView_SelectedItemChanged">
			<TreeView.ItemContainerStyle>
				<Style TargetType="TreeViewItem">
					<Setter Property="IsExpanded" Value="True"/>
				</Style>
			</TreeView.ItemContainerStyle>
		</TreeView>

		<Grid Grid.Column="1">
			<Grid.RowDefinitions>
				<RowDefinition Height="Auto"/>
				<RowDefinition Height="*"/>
			</Grid.RowDefinitions>

			<TextBlock Grid.Row="0" 
                       HorizontalAlignment="Center" 
                       Margin="0,30,0,20" 
                       FontWeight="DemiBold" 
                       FontSize="30"
                       Text="文献详细信息"/>

			<Border Grid.Row="1" 
                    VerticalAlignment="Top" 
                    HorizontalAlignment="Center" 
                    Width="700"
                    Margin="0,0,0,20">
				<Border CornerRadius="15" 
                        BorderThickness="1" 
                        BorderBrush="LightGray" 
                        Background="White" 
                        Padding="25">
					<ScrollViewer VerticalScrollBarVisibility="Auto">
						<StackPanel>
							<TextBlock Text="标题:" FontWeight="Bold" Margin="0,5,0,2"/>
							<TextBox Text="{Binding SelectedArticle.Message.Title[0]}" 
                                     FontSize="16" 
                                     Margin="0,0,0,15"
                                     BorderThickness="0,0,0,1"
                                     BorderBrush="LightGray"
                                     Padding="0,5"/>

							<TextBlock Text="作者:" FontWeight="Bold" Margin="0,5,0,2"/>
							<TextBox Text="{Binding SelectedArticle.Message.Author, Converter={StaticResource AuthorsConverter}}" 
                                     FontSize="16" 
                                     Margin="0,0,0,15"
                                     BorderThickness="0,0,0,1"
                                     BorderBrush="LightGray"
                                     Padding="0,5"/>

							<Grid Margin="0,0,0,15">
								<Grid.ColumnDefinitions>
									<ColumnDefinition Width="*"/>
									<ColumnDefinition Width="20"/>
									<ColumnDefinition Width="*"/>
								</Grid.ColumnDefinitions>
								<StackPanel Grid.Column="0">
									<TextBlock Text="期刊名称:" FontWeight="Bold" Margin="0,5,0,2"/>
									<TextBox Text="{Binding SelectedArticle.Message.Container[0]}" 
                                             FontSize="16" 
                                             BorderThickness="0,0,0,1"
                                             BorderBrush="LightGray"
                                             Padding="0,5"/>
								</StackPanel>
								<StackPanel Grid.Column="2">
									<TextBlock Text="发表日期:" FontWeight="Bold" Margin="0,5,0,2"/>
									<DatePicker SelectedDate="{Binding SelectedArticle.Message.Published, Converter={StaticResource DateConverter}}" 
                                                FontSize="16" 
                                                BorderThickness="0,0,0,1"
                                                BorderBrush="LightGray"
                                                Padding="0,5"/>
								</StackPanel>
							</Grid>

							<Grid Margin="0,0,0,15">
								<Grid.ColumnDefinitions>
									<ColumnDefinition Width="*"/>
									<ColumnDefinition Width="20"/>
									<ColumnDefinition Width="*"/>
									<ColumnDefinition Width="20"/>
									<ColumnDefinition Width="*"/>
								</Grid.ColumnDefinitions>
								<StackPanel Grid.Column="0">
									<TextBlock Text="卷号:" FontWeight="Bold" Margin="0,5,0,2"/>
									<TextBox Text="{Binding SelectedArticle.Message.Volume}" 
                                             FontSize="16" 
                                             BorderThickness="0,0,0,1"
                                             BorderBrush="LightGray"
                                             Padding="0,5"/>
								</StackPanel>
								<StackPanel Grid.Column="2">
									<TextBlock Text="期号:" FontWeight="Bold" Margin="0,5,0,2"/>
									<TextBox Text="{Binding SelectedArticle.Message.Issue}" 
                                             FontSize="16" 
                                             BorderThickness="0,0,0,1"
                                             BorderBrush="LightGray"
                                             Padding="0,5"/>
								</StackPanel>
								<StackPanel Grid.Column="4">
									<TextBlock Text="页码:" FontWeight="Bold" Margin="0,5,0,2"/>
									<TextBox Text="{Binding SelectedArticle.Message.Page}" 
                                             FontSize="16" 
                                             BorderThickness="0,0,0,1"
                                             BorderBrush="LightGray"
                                             Padding="0,5"/>
								</StackPanel>
							</Grid>

							<TextBlock Text="DOI:" FontWeight="Bold" Margin="0,5,0,2"/>
							<TextBox Text="{Binding SelectedArticle.Message.Doi}" 
                                     FontSize="16" 
                                     Margin="0,0,0,15"
                                     BorderThickness="0,0,0,1"
                                     BorderBrush="LightGray"
                                     Padding="0,5"/>

							<TextBlock Text="URL:" FontWeight="Bold" Margin="0,5,0,2"/>
							<TextBox Text="{Binding SelectedArticle.Message.Url}" 
                                     FontSize="16" 
                                     Margin="0,0,0,15"
                                     BorderThickness="0,0,0,1"
                                     BorderBrush="LightGray"
                                     Padding="0,5"/>

							<TextBlock Text="摘要:" FontWeight="Bold" Margin="0,5,0,2"/>
							<TextBox Text="{Binding SelectedArticle.Message.Abstract}" 
                                     FontSize="16" 
                                     MinHeight="100"
                                     AcceptsReturn="True"
                                     TextWrapping="Wrap"
                                     IsReadOnly="True"
                                     Background="#FAFAFA"
                                     BorderThickness="1"
                                     BorderBrush="LightGray"
                                     Padding="5"/>
						</StackPanel>
					</ScrollViewer>
				</Border>
			</Border>
		</Grid>
	</Grid>
</UserControl>