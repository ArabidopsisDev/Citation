<UserControl
	x:Class="Citation.View.Page.ViewReferencePage"
	xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
	xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
	xmlns:c="clr-namespace:Citation.Model.Convert"
	xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
	xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
	xmlns:model="clr-namespace:Citation.Model.Reference"
	d:DesignHeight="600"
	d:DesignWidth="800"
	Loaded="ViewReferencePage_OnLoaded"
	mc:Ignorable="d">

	<UserControl.Resources>
		<c:AuthorConverter x:Key="AuthorsConverter" />
		<c:DateConverter x:Key="DateConverter" />

		<Style x:Key="SegmentedButtonStyle" TargetType="ToggleButton">
			<Setter Property="Background" Value="White" />
			<Setter Property="Foreground" Value="#0078D7" />
			<Setter Property="BorderBrush" Value="#0078D7" />
			<Setter Property="BorderThickness" Value="1" />
			<Setter Property="Template">
				<Setter.Value>
					<ControlTemplate TargetType="ToggleButton">
						<Border
							x:Name="border"
							Background="{TemplateBinding Background}"
							BorderBrush="{TemplateBinding BorderBrush}"
							BorderThickness="{TemplateBinding BorderThickness}"
							CornerRadius="0">
							<ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center" />
						</Border>
						<ControlTemplate.Triggers>
							<Trigger Property="IsChecked" Value="True">
								<Setter Property="Background" Value="#0078D7" />
								<Setter Property="Foreground" Value="White" />
								<Setter TargetName="border" Property="BorderBrush" Value="#0078D7" />
							</Trigger>
							<Trigger Property="IsChecked" Value="False">
								<Setter Property="Background" Value="White" />
								<Setter Property="Foreground" Value="#0078D7" />
							</Trigger>
						</ControlTemplate.Triggers>
					</ControlTemplate>
				</Setter.Value>
			</Setter>
		</Style>

		<HierarchicalDataTemplate DataType="{x:Type model:FolderItem}" ItemsSource="{Binding Articles}">
			<StackPanel Orientation="Horizontal">
				<Image
					Width="16"
					Height="20"
					Margin="0,0,5,0"
					Source="pack://application:,,,/Citation;component/Images/folder.png" />
				<TextBlock
					VerticalAlignment="Center"
					FontWeight="SemiBold"
					Text="{Binding Name}" />
				<TextBlock
					Margin="5,0,0,0"
					VerticalAlignment="Center"
					Foreground="Gray"
					Text="{Binding Articles.Count, StringFormat=' ({0})'}" />
			</StackPanel>
		</HierarchicalDataTemplate>

		<DataTemplate DataType="{x:Type model:JournalArticle}">
			<StackPanel Margin="10,2,0,2" Orientation="Horizontal">
				<Image
					Width="16"
					Height="16"
					Margin="0,0,5,0"
					Source="pack://application:,,,/Citation;component/Images/article.png" />
				<TextBlock VerticalAlignment="Center" Text="{Binding Message.Title[0]}" />
			</StackPanel>
		</DataTemplate>
	</UserControl.Resources>

	<Grid Background="#F5F5F5">
		<Grid.ColumnDefinitions>
			<ColumnDefinition Width="250" />
			<ColumnDefinition Width="*" />
		</Grid.ColumnDefinitions>

		<TreeView
			Name="FolderTreeView"
			Grid.Column="0"
			Margin="10"
			SelectedItemChanged="TreeView_SelectedItemChanged">
			<TreeView.ItemContainerStyle>
				<Style TargetType="TreeViewItem">
					<Setter Property="IsExpanded" Value="True" />
				</Style>
			</TreeView.ItemContainerStyle>
		</TreeView>

		<Grid Grid.Column="1">
			<Grid.RowDefinitions>
				<RowDefinition Height="Auto" />
				<RowDefinition Height="*" />
			</Grid.RowDefinitions>

			<TextBlock
				Grid.Row="0"
				Margin="0,30,0,20"
				HorizontalAlignment="Center"
				FontSize="30"
				FontWeight="DemiBold"
				Text="文献详细信息" />

			<Border
				Grid.Row="1"
				Width="700"
				Margin="0,0,0,20"
				HorizontalAlignment="Center"
				VerticalAlignment="Top">
				<Border
					Padding="25"
					d:IsLocked="True"
					Background="White"
					BorderBrush="LightGray"
					BorderThickness="1"
					CornerRadius="15">
					<ScrollViewer VerticalScrollBarVisibility="Auto">
						<StackPanel>
							<TextBlock
								Margin="0,5,0,2"
								FontWeight="Bold"
								Text="标题:" />
							<TextBox
								Margin="0,0,0,15"
								Padding="0,5"
								BorderBrush="LightGray"
								BorderThickness="0,0,0,1"
								FontFamily="Calibri"
								FontSize="16"
								Text="{Binding SelectedArticle.Message.Title[0]}" />

							<TextBlock
								Margin="0,5,0,2"
								FontWeight="Bold"
								Text="作者:" />
							<TextBox
								Margin="0,0,0,15"
								Padding="0,5"
								BorderBrush="LightGray"
								BorderThickness="0,0,0,1"
								FontFamily="Calibri"
								FontSize="16"
								Text="{Binding SelectedArticle.Message.Author, Converter={StaticResource AuthorsConverter}}" />

							<Grid Margin="0,0,0,15">
								<Grid.ColumnDefinitions>
									<ColumnDefinition Width="*" />
									<ColumnDefinition Width="20" />
									<ColumnDefinition Width="*" />
								</Grid.ColumnDefinitions>
								<StackPanel Grid.Column="0">
									<TextBlock
										Margin="0,5,0,2"
										FontWeight="Bold"
										Text="期刊名称:" />
									<TextBox
										Padding="0,5"
										BorderBrush="LightGray"
										BorderThickness="0,0,0,1"
										FontFamily="Calibri"
										FontSize="16"
										Text="{Binding SelectedArticle.Message.Container[0]}" />
								</StackPanel>
								<StackPanel Grid.Column="2">
									<TextBlock
										Margin="0,5,0,2"
										FontWeight="Bold"
										Text="发表日期:" />
									<DatePicker
										Padding="0,5"
										BorderBrush="LightGray"
										BorderThickness="0,0,0,1"
										FontFamily="Calibri"
										FontSize="16"
										SelectedDate="{Binding SelectedArticle.Message.Published, Converter={StaticResource DateConverter}}" />
								</StackPanel>
							</Grid>

							<Grid Margin="0,0,0,15">
								<Grid.ColumnDefinitions>
									<ColumnDefinition Width="*" />
									<ColumnDefinition Width="20" />
									<ColumnDefinition Width="*" />
									<ColumnDefinition Width="20" />
									<ColumnDefinition Width="*" />
								</Grid.ColumnDefinitions>
								<StackPanel Grid.Column="0">
									<TextBlock
										Margin="0,5,0,2"
										FontWeight="Bold"
										Text="卷号:" />
									<TextBox
										Padding="0,5"
										BorderBrush="LightGray"
										BorderThickness="0,0,0,1"
										FontFamily="Calibri"
										FontSize="16"
										Text="{Binding SelectedArticle.Message.Volume}" />
								</StackPanel>
								<StackPanel Grid.Column="2">
									<TextBlock
										Margin="0,5,0,2"
										FontWeight="Bold"
										Text="期号:" />
									<TextBox
										Padding="0,5"
										BorderBrush="LightGray"
										BorderThickness="0,0,0,1"
										FontFamily="Calibri"
										FontSize="16"
										Text="{Binding SelectedArticle.Message.Issue}" />
								</StackPanel>
								<StackPanel Grid.Column="4">
									<TextBlock
										Margin="0,5,0,2"
										FontWeight="Bold"
										Text="页码:" />
									<TextBox
										Padding="0,5"
										BorderBrush="LightGray"
										BorderThickness="0,0,0,1"
										FontFamily="Calibri"
										FontSize="16"
										Text="{Binding SelectedArticle.Message.Page}" />
								</StackPanel>
							</Grid>

							<TextBlock
								Margin="0,5,0,2"
								FontWeight="Bold"
								Text="DOI:" />
							<TextBox
								Margin="0,0,0,15"
								Padding="0,5"
								BorderBrush="LightGray"
								BorderThickness="0,0,0,1"
								FontFamily="Calibri"
								FontSize="16"
								Text="{Binding SelectedArticle.Message.Doi}" />

							<TextBlock
								Margin="0,5,0,2"
								FontWeight="Bold"
								Text="URL:" />
							<TextBox
								Margin="0,0,0,15"
								Padding="0,5"
								BorderBrush="LightGray"
								BorderThickness="0,0,0,1"
								FontFamily="Calibri"
								FontSize="16"
								Text="{Binding SelectedArticle.Message.Url}" />

							<TextBlock
								Margin="0,5,0,2"
								FontWeight="Bold"
								Text="摘要:" />
							<TextBox
								MinHeight="100"
								Padding="5"
								AcceptsReturn="True"
								Background="#FAFAFA"
								BorderBrush="LightGray"
								BorderThickness="1"
								FontFamily="Calibri"
								FontSize="16"
								IsReadOnly="True"
								Text="{Binding SelectedArticle.Message.Abstract}"
								TextWrapping="Wrap" />


							<TextBlock
								Margin="0,5,0,2"
								FontWeight="Bold"
								Text="引用格式:" />
							<TextBox
								Name="CitationBox"
								MinHeight="100"
								Padding="5"
								AcceptsReturn="True"
								Background="#FAFAFA"
								BorderBrush="LightGray"
								BorderThickness="1"
								FontFamily="Calibri"
								FontSize="16"
								IsReadOnly="True"
								Text="您尚未选择输出类型"
								TextWrapping="Wrap" />

							<StackPanel
								Margin="0,20,0,0"
								HorizontalAlignment="Center"
								Orientation="Horizontal">
								<Border
									Margin="0,0,20,0"
									BorderBrush="#0078D7"
									BorderThickness="1"
									CornerRadius="3">
									<StackPanel Orientation="Horizontal">
										<RadioButton
											x:Name="MarkdownButton"
											Width="100"
											Height="40"
											BorderThickness="1,1,0,1"
											Click="MarkdownButton_OnClick"
											Content="Markdown"
											GroupName="ExportFormat"
											IsChecked="True"
											Style="{StaticResource SegmentedButtonStyle}" />
										<RadioButton
											x:Name="LatexButton"
											Width="100"
											Height="40"
											BorderThickness="0,1,1,1"
											Click="LatexButton_OnClick"
											Content="LaTeX"
											GroupName="ExportFormat"
											Style="{StaticResource SegmentedButtonStyle}" />
									</StackPanel>
								</Border>

								<Button
									Width="120"
									Height="40"
									Margin="40,0,20,0"
									Background="#0078D7"
									BorderThickness="0"
									Click="CopyButton_Click"
									Content="复制引用"
									FontSize="16"
									FontWeight="Medium"
									Foreground="White">
									<Button.Template>
										<ControlTemplate TargetType="Button">
											<Border
												x:Name="border"
												Background="{TemplateBinding Background}"
												BorderThickness="0"
												CornerRadius="20">
												<ContentPresenter
													x:Name="contentPresenter"
													HorizontalAlignment="Center"
													VerticalAlignment="Center" />
											</Border>
										</ControlTemplate>
									</Button.Template>
								</Button>

								<Button
									Width="120"
									Height="40"
									Background="LightGray"
									BorderThickness="0"
									Click="RemoveButton_Click"
									Content="删除"
									FontSize="16"
									FontWeight="Medium"
									Foreground="Black">
									<Button.Template>
										<ControlTemplate TargetType="Button">
											<Border
												x:Name="border"
												Background="{TemplateBinding Background}"
												BorderThickness="0"
												CornerRadius="20">
												<ContentPresenter
													x:Name="contentPresenter"
													HorizontalAlignment="Center"
													VerticalAlignment="Center" />
											</Border>
										</ControlTemplate>
									</Button.Template>
								</Button>
							</StackPanel>
						</StackPanel>
					</ScrollViewer>
				</Border>
			</Border>
		</Grid>
	</Grid>
</UserControl>