<UserControl
    x:Class="Citation.View.Page.FieldExperimentPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:local="clr-namespace:Citation.View.Page"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    d:DesignHeight="768"
    d:DesignWidth="1024"
    Background="#F4F6FB"
    Loaded="UserControl_Loaded"
    mc:Ignorable="d">

    <UserControl.Resources>
        <!--  Modern Tool Button Style  -->
        <Style x:Key="ToolButtonStyle" TargetType="RadioButton">
            <Setter Property="Width" Value="44" />
            <Setter Property="Height" Value="44" />
            <Setter Property="Margin" Value="4" />
            <Setter Property="Background" Value="#E3E8F0" />
            <Setter Property="BorderBrush" Value="#CBD5E1" />
            <Setter Property="BorderThickness" Value="0" />
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="RadioButton">
                        <Border
                            x:Name="border"
                            Background="{TemplateBinding Background}"
                            BorderBrush="{TemplateBinding BorderBrush}"
                            BorderThickness="0"
                            CornerRadius="8"
                            SnapsToDevicePixels="True">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center" />
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsChecked" Value="True">
                                <Setter TargetName="border" Property="Background" Value="#6366F1" />
                                <Setter TargetName="border" Property="BorderBrush" Value="#6366F1" />
                                <Setter TargetName="border" Property="Opacity" Value="1" />
                            </Trigger>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="border" Property="Background" Value="#A5B4FC" />
                                <Setter TargetName="border" Property="BorderBrush" Value="#6366F1" />
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
        <DropShadowEffect
            x:Key="ShadowEffect"
            BlurRadius="6"
            Direction="270"
            ShadowDepth="2"
            Color="#888" />
        <Style x:Key="PropertyLabelStyle" TargetType="TextBlock">
            <Setter Property="VerticalAlignment" Value="Center" />
            <Setter Property="FontWeight" Value="SemiBold" />
            <Setter Property="Margin" Value="0,0,8,0" />
            <Setter Property="Foreground" Value="#374151" />
        </Style>
        <Style x:Key="PropertyTextBoxStyle" TargetType="TextBox">
            <Setter Property="Margin" Value="0,2" />
            <Setter Property="Padding" Value="6,2" />
            <Setter Property="BorderBrush" Value="#6366F1" />
            <Setter Property="BorderThickness" Value="1" />
            <Setter Property="Background" Value="#F8FAFC" />
            <Setter Property="FontSize" Value="13" />
            <Setter Property="Foreground" Value="#334155" />
        </Style>
        <!--  Modern Button Style  -->
        <Style x:Key="ModernButton" TargetType="Button">
            <Setter Property="FontWeight" Value="SemiBold" />
            <Setter Property="Padding" Value="8,4" />
            <Setter Property="Margin" Value="4,2" />
            <Setter Property="Background" Value="#6366F1" />
            <Setter Property="Foreground" Value="White" />
            <Setter Property="BorderBrush" Value="#6366F1" />
            <Setter Property="BorderThickness" Value="0" />
            <Setter Property="Effect" Value="{StaticResource ShadowEffect}" />
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border
                            Background="{TemplateBinding Background}"
                            BorderBrush="{TemplateBinding BorderBrush}"
                            BorderThickness="0">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center" />
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
    </UserControl.Resources>

    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="Auto" />
            <ColumnDefinition Width="220" />
            <ColumnDefinition Width="*" />
        </Grid.ColumnDefinitions>

        <!--  Left ToolBar  -->
        <StackPanel
            Grid.Column="0"
            Width="56"
            Background="#E3E8F0">
            <TextBlock
                Margin="6,16,6,4"
                HorizontalAlignment="Center"
                FontSize="14"
                FontWeight="Bold"
                Foreground="#6366F1"
                Text="工具" />
            <Separator
                Height="2"
                Margin="4,0"
                Background="#C7D2FE" />
            <!--  Tool Buttons with Checked event  -->
            <RadioButton
                x:Name="SelectToolButton"
                Checked="ToolButton_Checked"
                GroupName="Tools"
                Style="{StaticResource ToolButtonStyle}"
                ToolTip="选择工具">
                <Image
                    Width="28"
                    Height="28"
                    Source="pack://application:,,,/Citation;component/Images/select_tool.png" />
            </RadioButton>
            <RadioButton
                x:Name="FieldToolButton"
                Checked="ToolButton_Checked"
                GroupName="Tools"
                Style="{StaticResource ToolButtonStyle}"
                ToolTip="绘制田间小区">
                <Image
                    Width="28"
                    Height="28"
                    Source="pack://application:,,,/Citation;component/Images/field_tool.png" />
            </RadioButton>
            <RadioButton
                x:Name="BlockToolButton"
                Checked="ToolButton_Checked"
                GroupName="Tools"
                Style="{StaticResource ToolButtonStyle}"
                ToolTip="绘制区组">
                <Image
                    Width="28"
                    Height="28"
                    Source="pack://application:,,,/Citation;component/Images/block_tool.png" />
            </RadioButton>
            <RadioButton
                x:Name="PlotToolButton"
                Checked="ToolButton_Checked"
                GroupName="Tools"
                Style="{StaticResource ToolButtonStyle}"
                ToolTip="绘制试验小区">
                <Image
                    Width="28"
                    Height="28"
                    Source="pack://application:,,,/Citation;component/Images/plot_tool.png" />
            </RadioButton>
            <RadioButton
                x:Name="SignboardToolButton"
                Checked="ToolButton_Checked"
                GroupName="Tools"
                Style="{StaticResource ToolButtonStyle}"
                ToolTip="添加标识牌">
                <Image
                    Width="28"
                    Height="28"
                    Source="pack://application:,,,/Citation;component/Images/signboard_tool.png" />
            </RadioButton>
            <Separator
                Height="2"
                Margin="4,0"
                Background="#C7D2FE" />
            <RadioButton
                x:Name="ZoomToolButton"
                Checked="ToolButton_Checked"
                GroupName="Tools"
                Style="{StaticResource ToolButtonStyle}"
                ToolTip="缩放工具">
                <Image
                    Width="28"
                    Height="28"
                    Source="pack://application:,,,/Citation;component/Images/zoom_tool.png" />
            </RadioButton>
            <RadioButton
                x:Name="PanToolButton"
                Checked="ToolButton_Checked"
                GroupName="Tools"
                IsChecked="True"
                Style="{StaticResource ToolButtonStyle}"
                ToolTip="平移工具">
                <Image
                    Width="28"
                    Height="28"
                    Source="pack://application:,,,/Citation;component/Images/pan_tool.png" />
            </RadioButton>
        </StackPanel>

        <!--  Right Property Panel  -->
        <GridSplitter
            Grid.Column="0"
            Width="2"
            HorizontalAlignment="Right"
            Background="#C7D2FE" />

        <ScrollViewer
            Grid.Column="1"
            Background="#F8FAFC"
            HorizontalScrollBarVisibility="Disabled"
            VerticalScrollBarVisibility="Auto">
            <StackPanel Margin="8">
                <TextBlock
                    Margin="0,14,0,8"
                    FontSize="15"
                    FontWeight="Bold"
                    Foreground="#6366F1"
                    Text="属性" />
                <Separator />
                <!--  Selected Object Properties  -->
                <ContentControl x:Name="PropertyPanel" />
                <!--  Experiment Properties  -->
                <Expander
                    x:Name="ExperimentPropertiesExpander"
                    Margin="0,12,0,0"
                    Header="试验属性"
                    IsExpanded="True">
                    <StackPanel>
                        <TextBlock Style="{StaticResource PropertyLabelStyle}" Text="试验名称" />
                        <TextBox x:Name="ExperimentNameTextBox" Style="{StaticResource PropertyTextBoxStyle}" />
                        <TextBlock
                            Margin="0,10,0,0"
                            Style="{StaticResource PropertyLabelStyle}"
                            Text="试验描述" />
                        <TextBox
                            x:Name="ExperimentDescTextBox"
                            Height="60"
                            AcceptsReturn="True"
                            Style="{StaticResource PropertyTextBoxStyle}"
                            TextWrapping="Wrap"
                            VerticalScrollBarVisibility="Auto" />
                        <TextBlock
                            Margin="0,10,0,0"
                            Style="{StaticResource PropertyLabelStyle}"
                            Text="设计类型" />
                        <ComboBox
                            x:Name="DesignTypeComboBox"
                            Margin="0,2"
                            SelectedIndex="0">
                            <ComboBoxItem Content="完全随机设计" />
                            <ComboBoxItem Content="随机区组设计" />
                            <ComboBoxItem Content="裂区设计" />
                            <ComboBoxItem Content="拉丁方设计" />
                        </ComboBox>
                    </StackPanel>
                </Expander>
                <!--  Treatment Library  -->
                <Expander
                    Margin="0,12,0,0"
                    Header="处理库"
                    IsExpanded="True">
                    <StackPanel>
                        <ListBox
                            x:Name="TreatmentListBox"
                            Height="120"
                            Margin="0,0,0,5"
                            Background="#F8FAFC"
                            BorderBrush="#6366F1"
                            BorderThickness="1"
                            SelectionMode="Single">
                            <ListBox.ItemTemplate>
                                <DataTemplate>
                                    <StackPanel Orientation="Horizontal">
                                        <Rectangle
                                            Width="18"
                                            Height="18"
                                            Margin="0,0,6,0"
                                            Fill="{Binding Color}"
                                            RadiusX="5"
                                            RadiusY="5"
                                            Stroke="#6366F1" />
                                        <TextBlock
                                            VerticalAlignment="Center"
                                            Foreground="#334155"
                                            Text="{Binding Name}" />
                                    </StackPanel>
                                </DataTemplate>
                            </ListBox.ItemTemplate>
                        </ListBox>
                        <StackPanel Margin="0,2" Orientation="Horizontal">
                            <Button
                                x:Name="AddTreatmentButton"
                                Width="50"
                                Height="25"
                                Click="AddTreatmentButton_Click"
                                Content="添加"
                                Style="{StaticResource ModernButton}" />
                            <Button
                                x:Name="EditTreatmentButton"
                                Width="50"
                                Height="25"
                                Click="EditTreatmentButton_Click"
                                Content="编辑"
                                Style="{StaticResource ModernButton}" />
                            <Button
                                x:Name="RemoveTreatmentButton"
                                Width="50"
                                Height="25"
                                Click="RemoveTreatmentButton_Click"
                                Content="删除"
                                Style="{StaticResource ModernButton}" />
                        </StackPanel>
                    </StackPanel>
                </Expander>
            </StackPanel>
        </ScrollViewer>

        <GridSplitter
            Grid.Column="1"
            Width="2"
            HorizontalAlignment="Right"
            Background="#C7D2FE" />

        <!--  Center Canvas Area  -->
        <Grid Grid.Column="2">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto" />
                <RowDefinition Height="*" />
                <RowDefinition Height="Auto" />
            </Grid.RowDefinitions>

            <!--  Canvas Toolbar  -->
            <ToolBarTray Grid.Row="0" Background="#EEF2FF">
                <ToolBar Background="#EEF2FF">
                    <Button
                        x:Name="NewExperimentButton"
                        Width="60"
                        Height="25"
                        Click="NewExperimentButton_Click"
                        Style="{StaticResource ModernButton}"
                        ToolTip="新建试验">
                        <StackPanel Orientation="Horizontal">
                            <Image
                                Width="18"
                                Height="18"
                                Source="pack://application:,,,/Citation;component/Images/new_experiment.png" />
                            <TextBlock Margin="6,0,0,0" Text="新建" />
                        </StackPanel>
                    </Button>
                    <Button
                        x:Name="SaveExperimentButton"
                        Width="60"
                        Height="25"
                        Click="SaveExperimentButton_Click"
                        Style="{StaticResource ModernButton}"
                        ToolTip="保存试验">
                        <StackPanel Orientation="Horizontal">
                            <Image
                                Width="18"
                                Height="18"
                                Source="pack://application:,,,/Citation;component/Images/save_experiment.png" />
                            <TextBlock Margin="6,0,0,0" Text="保存" />
                        </StackPanel>
                    </Button>
                    <Button
                        x:Name="LoadExperimentButton"
                        Width="60"
                        Height="25"
                        Click="LoadExperimentButton_Click"
                        Style="{StaticResource ModernButton}"
                        ToolTip="加载试验">
                        <StackPanel Orientation="Horizontal">
                            <Image
                                Width="18"
                                Height="18"
                                Source="pack://application:,,,/Citation;component/Images/load_experiment.png" />
                            <TextBlock Margin="6,0,0,0" Text="加载" />
                        </StackPanel>
                    </Button>
                    <Separator />
                    <Button
                        x:Name="ZoomInButton"
                        Width="30"
                        Height="25"
                        Click="ZoomInButton_Click"
                        Style="{StaticResource ModernButton}"
                        ToolTip="放大">
                        <Image
                            Width="18"
                            Height="18"
                            Source="pack://application:,,,/Citation;component/Images/zoom_in.png" />
                    </Button>
                    <Button
                        x:Name="ZoomOutButton"
                        Width="30"
                        Height="25"
                        Click="ZoomOutButton_Click"
                        Style="{StaticResource ModernButton}"
                        ToolTip="缩小">
                        <Image
                            Width="18"
                            Height="18"
                            Source="pack://application:,,,/Citation;component/Images/zoom_out.png" />
                    </Button>
                    <Button
                        x:Name="ZoomFitButton"
                        Width="30"
                        Height="25"
                        Click="ZoomFitButton_Click"
                        Style="{StaticResource ModernButton}"
                        ToolTip="适应窗口">
                        <Image
                            Width="18"
                            Height="18"
                            Source="pack://application:,,,/Citation;component/Images/zoom_fit.png" />
                    </Button>
                    <Button
                        x:Name="Zoom100Button"
                        Width="50"
                        Height="25"
                        Click="Zoom100Button_Click"
                        Style="{StaticResource ModernButton}"
                        ToolTip="实际大小">
                        <TextBlock Margin="2,0,2,0" Text="100%" />
                    </Button>
                </ToolBar>
            </ToolBarTray>

            <!--  Main Canvas  -->
            <ScrollViewer
                x:Name="CanvasScrollViewer"
                Grid.Row="1"
                Background="#F8FAFC"
                HorizontalScrollBarVisibility="Auto"
                PanningMode="Both"
                PreviewMouseWheel="CanvasScrollViewer_PreviewMouseWheel"
                VerticalScrollBarVisibility="Auto">
                <Canvas
                    x:Name="MainCanvas"
                    Width="2000"
                    Height="2000"
                    Background="#F1F5F9"
                    MouseLeftButtonDown="MainCanvas_MouseLeftButtonDown"
                    MouseLeftButtonUp="MainCanvas_MouseLeftButtonUp"
                    MouseMove="MainCanvas_MouseMove">
                    <!--  Grid Background  -->
                    <Rectangle
                        x:Name="GridBackground"
                        Width="{Binding ActualWidth, ElementName=MainCanvas}"
                        Height="{Binding ActualHeight, ElementName=MainCanvas}"
                        Panel.ZIndex="-100"
                        Fill="White" />
                    <!--  Selection Rectangle Preview  -->
                    <Rectangle
                        x:Name="SelectionRectangle"
                        Panel.ZIndex="100"
                        Fill="#B4BDFE33"
                        Stroke="#6366F1"
                        StrokeDashArray="6,2"
                        StrokeThickness="2"
                        Visibility="Collapsed" />
                    <!--  Dynamic elements: fields, blocks, plots, signboards  -->
                </Canvas>
            </ScrollViewer>

            <!--  Status Bar  -->
            <StatusBar Grid.Row="2" Background="#EEF2FF">
                <StatusBarItem>
                    <TextBlock
                        x:Name="CursorPositionText"
                        Foreground="#6366F1"
                        Text="X: 0, Y: 0" />
                </StatusBarItem>
                <StatusBarItem>
                    <Separator />
                </StatusBarItem>
                <StatusBarItem>
                    <TextBlock
                        x:Name="SelectedToolText"
                        Foreground="#6366F1"
                        Text="工具: 平移" />
                </StatusBarItem>
                <StatusBarItem>
                    <Separator />
                </StatusBarItem>
                <StatusBarItem>
                    <TextBlock
                        x:Name="ZoomLevelText"
                        Foreground="#6366F1"
                        Text="缩放: 100%" />
                </StatusBarItem>
            </StatusBar>
        </Grid>
    </Grid>
</UserControl>